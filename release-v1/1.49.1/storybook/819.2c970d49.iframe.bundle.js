"use strict";(self.webpackChunkstorybook=self.webpackChunkstorybook||[]).push([[819],{"../../node_modules/vidstack/prod/chunks/vidstack-DSYpsFWk.js":(e,t,s)=>{s.d(t,{e:()=>i});var a=s("../../node_modules/vidstack/prod/chunks/vidstack-CRlI3Mh7.js");class i{#e;#t;constructor(e){this.#t=e}start(){(0,a.b0)(this.#e)&&this.#s()}stop(){(0,a.Et)(this.#e)&&window.cancelAnimationFrame(this.#e),this.#e=void 0}#s(){this.#e=window.requestAnimationFrame(()=>{(0,a.b0)(this.#e)||(this.#t(),this.#s())})}}},"../../node_modules/vidstack/prod/providers/vidstack-google-cast.js":(e,t,s)=>{s.r(t),s.d(t,{GoogleCastProvider:()=>u});var a=s("../../node_modules/vidstack/prod/chunks/vidstack-CRlI3Mh7.js"),i=s("../../node_modules/vidstack/prod/chunks/vidstack-BmMUBVGQ.js"),r=s("../../node_modules/vidstack/prod/chunks/vidstack-DSYpsFWk.js"),n=s("../../node_modules/vidstack/prod/chunks/vidstack-D5EzK014.js"),o=s("../../node_modules/vidstack/prod/chunks/vidstack-IHrfMzpQ.js");class c{#a;constructor(e){this.#a=new chrome.cast.media.MediaInfo(e.src,e.type)}build(){return this.#a}setStreamType(e){return e.includes("live")?this.#a.streamType=chrome.cast.media.StreamType.LIVE:this.#a.streamType=chrome.cast.media.StreamType.BUFFERED,this}setTracks(e){return this.#a.tracks=e.map(this.#i),this}setMetadata(e,t){return this.#a.metadata=new chrome.cast.media.GenericMediaMetadata,this.#a.metadata.title=e,this.#a.metadata.images=[{url:t}],this}#i(e,t){let s=new chrome.cast.media.Track(t,chrome.cast.media.TrackType.TEXT);return s.name=e.label,s.trackContentId=e.src,s.trackContentType="text/vtt",s.language=e.language,s.subtype=e.kind.toUpperCase(),s}}let h=chrome.cast.media.TrackType.TEXT,l=chrome.cast.media.TrackType.AUDIO;class d{#r;#n;#o;constructor(e,t,s){this.#r=e,this.#n=t,this.#o=s}setup(){let e=this.syncRemoteActiveIds.bind(this);(0,a.k6)(this.#n.audioTracks,"change",e),(0,a.k6)(this.#n.textTracks,"mode-change",e),(0,a.QZ)(this.#c.bind(this))}getLocalTextTracks(){return this.#n.$state.textTracks().filter(e=>e.src&&"vtt"===e.type)}#h(){return this.#n.$state.audioTracks()}#l(e){let t=this.#r.mediaInfo?.tracks??[];return e?t.filter(t=>t.type===e):t}#d(){let e=[],t=this.#h().find(e=>e.selected),s=this.getLocalTextTracks().filter(e=>"showing"===e.mode);if(t){let s=this.#l(l),a=this.#u(s,t);a&&e.push(a.trackId)}if(s?.length){let t=this.#l(h);if(t.length)for(let a of s){let s=this.#u(t,a);s&&e.push(s.trackId)}}return e}#c(){let e=this.getLocalTextTracks();if(!this.#r.isMediaLoaded)return;let t=this.#l(h);for(let s of e)if(!this.#u(t,s)){(0,a.vz)(()=>this.#o?.());break}}syncRemoteTracks(e){if(!this.#r.isMediaLoaded)return;let t=this.#h(),s=this.getLocalTextTracks(),a=this.#l(l),i=this.#l(h);for(let s of a){if(this.#m(t,s))continue;let a={id:s.trackId.toString(),label:s.name,language:s.language,kind:s.subtype??"main",selected:!1};this.#n.audioTracks[n.j.add](a,e)}for(let t of i){if(this.#m(s,t))continue;let a={id:t.trackId.toString(),src:t.trackContentId,label:t.name,language:t.language,kind:t.subtype.toLowerCase()};this.#n.textTracks.add(a,e)}}syncRemoteActiveIds(e){if(!this.#r.isMediaLoaded)return;let t=this.#d(),s=new chrome.cast.media.EditTracksInfoRequest(t);this.#k(s).catch(e=>{})}#k(e){let t=(0,o.Cs)();return new Promise((s,a)=>t?.editTracksInfo(e,s,a))}#m(e,t){return e.find(e=>this.#p(e,t))}#u(e,t){return e.find(e=>this.#p(t,e))}#p(e,t){return t.name===e.label&&t.language===e.language&&t.subtype.toLowerCase()===e.kind.toLowerCase()}}class u{$$PROVIDER_TYPE="GOOGLE_CAST";scope=(0,a.Ds)();#y;#n;#g;#f=null;#T="disconnected";#C=0;#v=0;#E=new i.zJ(0,0);#S=new r.e(this.#L.bind(this));#x;#I=null;#R=!1;constructor(e,t){this.#y=e,this.#n=t,this.#g=new d(e,t,this.#o.bind(this))}get type(){return"google-cast"}get currentSrc(){return this.#f}get player(){return this.#y}get cast(){return(0,o.vY)()}get session(){return(0,o.aQ)()}get media(){return(0,o.Cs)()}get hasActiveSession(){return(0,o.Qg)(this.#f)}setup(){this.#b(),this.#A(),this.#g.setup(),this.#n.notify("provider-setup",this)}#b(){(0,o.It)(cast.framework.CastContextEventType.CAST_STATE_CHANGED,this.#w.bind(this))}#A(){let e=cast.framework.RemotePlayerEventType,t={[e.IS_CONNECTED_CHANGED]:this.#w,[e.IS_MEDIA_LOADED_CHANGED]:this.#M,[e.CAN_CONTROL_VOLUME_CHANGED]:this.#_,[e.CAN_SEEK_CHANGED]:this.#D,[e.DURATION_CHANGED]:this.#P,[e.IS_MUTED_CHANGED]:this.#N,[e.VOLUME_LEVEL_CHANGED]:this.#N,[e.IS_PAUSED_CHANGED]:this.#G,[e.LIVE_SEEKABLE_RANGE_CHANGED]:this.#V,[e.PLAYER_STATE_CHANGED]:this.#F};this.#x=t;let s=this.#O.bind(this);for(let e of(0,a.YD)(t))this.#y.controller.addEventListener(e,s);(0,a.zp)(()=>{for(let e of(0,a.YD)(t))this.#y.controller.removeEventListener(e,s)})}async play(){if(this.#y.isPaused||this.#R){if(this.#R){await this.#H(!1,0);return}this.#y.controller?.playOrPause()}}async pause(){this.#y.isPaused||this.#y.controller?.playOrPause()}getMediaStatus(e){return new Promise((t,s)=>{this.media?.getStatus(e,t,s)})}setMuted(e){(e&&!this.#y.isMuted||!e&&this.#y.isMuted)&&this.#y.controller?.muteOrUnmute()}setCurrentTime(e){this.#y.currentTime=e,this.#n.notify("seeking",e),this.#y.controller?.seek()}setVolume(e){this.#y.volumeLevel=e,this.#y.controller?.setVolumeLevel()}async loadSource(e){if(this.#I?.src!==e&&(this.#I=null),(0,o.Qg)(e)){this.#$(),this.#f=e;return}this.#n.notify("load-start");let t=this.#U(e),s=await this.session.loadMedia(t);if(s){this.#f=null,this.#n.notify("error",Error((0,o.tM)(s)));return}this.#f=e}destroy(){this.#z(),this.#j()}#z(){this.#I||(this.#v=0,this.#E=new i.zJ(0,0)),this.#S.stop(),this.#C=0,this.#I=null}#$(){let e=new a.vP("resume-session",{detail:this.session});this.#M(e);let{muted:t,volume:s,savedState:i}=this.#n.$state,r=i();this.setCurrentTime(Math.max(this.#y.currentTime,r?.currentTime??0)),this.setMuted(t()),this.setVolume(s()),r?.paused===!1&&this.play()}#j(){this.cast.endCurrentSession(!0);let{remotePlaybackLoader:e}=this.#n.$state;e.set(null)}#Y(){let{savedState:e}=this.#n.$state;e.set({paused:this.#y.isPaused,currentTime:this.#y.currentTime}),this.#j()}#L(){this.#J()}#O(e){this.#x[e.type].call(this,e)}#w(e){let t=this.cast.getCastState(),s=t===cast.framework.CastState.CONNECTED?"connected":t===cast.framework.CastState.CONNECTING?"connecting":"disconnected";if(this.#T===s)return;let a=this.#Q(e);this.#T=s,this.#n.notify("remote-playback-change",{type:"google-cast",state:s},a),"disconnected"===s&&this.#Y()}#M(e){if(!this.#y.isMediaLoaded)return;let t=(0,a.se)(this.#n.$state.source);Promise.resolve().then(()=>{if(t!==(0,a.se)(this.#n.$state.source)||!this.#y.isMediaLoaded)return;this.#z();let s=this.#y.duration;this.#E=new i.zJ(0,s);let r={provider:this,duration:s,buffered:new i.zJ(0,0),seekable:this.#q()},n=this.#Q(e);this.#n.notify("loaded-metadata",void 0,n),this.#n.notify("loaded-data",void 0,n),this.#n.notify("can-play",r,n),this.#_(),this.#D(e);let{volume:o,muted:c}=this.#n.$state;this.setVolume(o()),this.setMuted(c()),this.#S.start(),this.#g.syncRemoteTracks(n),this.#g.syncRemoteActiveIds(n)})}#_(){this.#n.$state.canSetVolume.set(this.#y.canControlVolume)}#D(e){let t=this.#Q(e);this.#n.notify("stream-type-change",this.#B(),t)}#B(){return this.#y.mediaInfo?.streamType===chrome.cast.media.StreamType.LIVE?this.#y.canSeek?"live:dvr":"live":"on-demand"}#J(){if(this.#I)return;let e=this.#y.currentTime;e!==this.#C&&(this.#n.notify("time-change",e),e>this.#v&&(this.#v=e,this.#V()),this.#n.$state.seeking()&&this.#n.notify("seeked",e),this.#C=e)}#P(e){if(!this.#y.isMediaLoaded||this.#I)return;let t=this.#y.duration,s=this.#Q(e);this.#E=new i.zJ(0,t),this.#n.notify("duration-change",t,s)}#N(e){if(!this.#y.isMediaLoaded)return;let t={muted:this.#y.isMuted,volume:this.#y.volumeLevel},s=this.#Q(e);this.#n.notify("volume-change",t,s)}#G(e){let t=this.#Q(e);this.#y.isPaused?this.#n.notify("pause",void 0,t):this.#n.notify("play",void 0,t)}#V(e){let t={seekable:this.#q(),buffered:new i.zJ(0,this.#v)},s=e?this.#Q(e):void 0;this.#n.notify("progress",t,s)}#F(e){let t=this.#y.playerState,s=chrome.cast.media.PlayerState;if(this.#R=t===s.IDLE,t===s.PAUSED)return;let a=this.#Q(e);switch(t){case s.PLAYING:this.#n.notify("playing",void 0,a);break;case s.BUFFERING:this.#n.notify("waiting",void 0,a);break;case s.IDLE:this.#S.stop(),this.#n.notify("pause"),this.#n.notify("end")}}#q(){return this.#y.liveSeekableRange?new i.zJ(this.#y.liveSeekableRange.start,this.#y.liveSeekableRange.end):this.#E}#Q(e){return e instanceof Event?e:new a.vP(e.type,{detail:e})}#K(e){let{streamType:t,title:s,poster:a}=this.#n.$state;return new c(e).setMetadata(s(),a()).setStreamType(t()).setTracks(this.#g.getLocalTextTracks()).build()}#U(e){let t=this.#K(e),s=new chrome.cast.media.LoadRequest(t),a=this.#n.$state.savedState();return s.autoplay=(this.#I?.paused??a?.paused)===!1,s.currentTime=this.#I?.time??a?.currentTime??0,s}async #H(e,t){let s=(0,a.se)(this.#n.$state.source);this.#I={src:s,paused:e,time:t},await this.loadSource(s)}#o(){this.#H(this.#y.isPaused,this.#y.currentTime).catch(e=>{})}}}}]);